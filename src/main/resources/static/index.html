<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebSocket Test</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sockjs-client/1.5.0/sockjs.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/stomp.js/2.3.3/stomp.min.js"></script>
</head>
<body>
<h1>WebSocket 연결 테스트 페이지입니다.</h1>

<ul>
    <li><a href="#" onclick="enterChatRoom(1)">채팅방 1 입장</a></li>
    <li><a href="/chatroom/2">채팅방 2 입장</a></li>
    <li><a href="/chatroom/3">채팅방 3 입장</a></li>
    <!-- 각 채팅방의 ID를 URL에 포함하여 링크를 생성 -->
</ul>

<input type="text" id="message" placeholder="메시지를 입력하세요">
<input type="file" id="imageInput" style="display: none;">
<button id="attachImage">이미지 첨부</button>
<button id="send">전송</button>
<div id="messageDisplay"></div>

<div id="imageDisplay"></div>

<script>
    function enterChatRoom(chatRoomId) {
        // 채팅방 접속 요청을 서버에 보냄
        // 채팅방 ID를 파라미터로 전달하여 서버에서 해당 채팅방에 접속 처리
        // 여기에서는 간단히 alert로 채팅방 ID 출력하도록 설정
        alert("채팅방 " + chatRoomId + "에 입장했습니다.");

        // 실제 서버에 요청을 보내는 코드를 작성해야 함
        // 예를 들어, Ajax나 fetch를 사용하여 서버에 요청을 보낼 수 있음
        // 서버는 해당 요청을 받아 채팅방에 접속 처리를 수행해야 함
    }

    window.onload = function() {
        // var ws = new WebSocket('ws://menteetor.site:8080/ws');
        var ws = new WebSocket('ws://localhost:8080/ws');
        var stompClient = Stomp.over(ws);

        // 이미지 첨부 버튼 클릭 시 input 태그 클릭
        document.getElementById('attachImage').addEventListener('click', function() {
            document.getElementById('imageInput').click();
        });

        // 이미지 파일 선택 시 base64로 변환하여 메시지와 함께 전송
        document.getElementById('imageInput').addEventListener('change', function() {
            var file = this.files[0];
            var reader = new FileReader();
            reader.onload = function(event) {
                var base64Image = event.target.result;
                // base64 이미지와 함께 메시지 전송
                sendMessage(base64Image);
            };
            reader.readAsDataURL(file);
        });

        // 메시지 전송 함수
        function sendMessage(base64Image) {
            var messageInput = document.querySelector('#message');
            var message = messageInput.value.trim();
            if (message !== '' || base64Image !== null) {
                var senderId = 1;
                var chatRoomId = 1;
                var senderName = "이종현";
                var time = new Date().toISOString();

                stompClient.send("/pub/hello", {}, JSON.stringify({
                    content: message,
                    senderName: senderName,
                    senderId: senderId,
                    chatRoomId: chatRoomId,
                    image: base64Image,
                    localDateTime: time
                }));

                messageInput.value = '';
            }
        }

        // 전송 버튼 클릭 시 메시지 전송
        document.querySelector('#send').onclick = function() {
            sendMessage(null); // 이미지 없이 메시지만 전송
        };

        // 메시지 수신
        stompClient.connect({}, function (frame) {
            console.log('Connected: ' + frame);
            stompClient.subscribe('/sub/chats/1', function (messageOutput) {
                console.log('Received: ' + messageOutput.body);
                var messageDisplay = document.querySelector('#messageDisplay');
                messageDisplay.innerHTML += messageOutput.body + '<br>';
            });
        });
    }
</script>
</body>
</html>



<!--<!DOCTYPE html>-->
<!--<html>-->
<!--<head>-->
<!--    <title>WebSocket Test</title>-->
<!--    <meta charset="UTF-8">-->
<!--    <script src="https://cdnjs.cloudflare.com/ajax/libs/sockjs-client/1.5.0/sockjs.min.js"></script>-->
<!--    <script src="https://cdnjs.cloudflare.com/ajax/libs/stomp.js/2.3.3/stomp.min.js"></script>-->
<!--    <script type="text/javascript">-->
<!--        window.onload = function() {-->
<!--            var socket = new SockJS('http://localhost:8080/ws');-->
<!--            var stompClient = Stomp.over(socket);-->

<!--            stompClient.connect({}, function(frame) {-->
<!--                console.log('Connected: ' + frame);-->
<!--                stompClient.subscribe('/sub/chats/52', function(messageOutput) {-->
<!--                    console.log('Received: ' + messageOutput.body);-->
<!--                });-->
<!--            });-->

<!--            document.querySelector('#send').onclick = function() {-->
<!--                var message = document.querySelector('#message').value;-->
<!--                stompClient.send("/pub/hello", {}, message);-->
<!--            };-->
<!--        }-->
<!--    </script>-->
<!--</head>-->
<!--<body>-->
<!--<h1>WebSocket 연결 테스트 페이지입니다.</h1>-->
<!--<input type="text" id="message" placeholder="메시지를 입력하세요">-->
<!--<button id="send">전송</button>-->
<!--</body>-->
<!--</html>-->

<!--<!DOCTYPE html>-->
<!--<html lang="en">-->
<!--<head>-->
<!--    <meta charset="UTF-8">-->
<!--    <meta name="viewport" content="width=device-width, initial-scale=1.0">-->
<!--    <title>Social Login</title>-->
<!--</head>-->
<!--<body>-->
<!--<h2>Social Login</h2>-->

<!--&lt;!&ndash; 카카오톡 소셜 로그인 링크 &ndash;&gt;-->
<!--<a href="login/kakao" target="_blank">-->
<!--    <img src="카카오톡_로고_URL" alt="카카오톡 로그인" width="150" height="40">-->
<!--</a>-->

<!--<br><br>-->

<!--&lt;!&ndash; 네이버 소셜 로그인 링크 &ndash;&gt;-->
<!--<a href="login/naver" target="_blank">-->
<!--    <img src="네이버_로고_URL" alt="네이버 로그인" width="150" height="40">-->
<!--</a>-->

<!--<br><br>-->

<!--&lt;!&ndash; 구글 소셜 로그인 링크 &ndash;&gt;-->
<!--<a href="구글_소셜_로그인_URL" target="_blank">-->
<!--    <img src="구글_로고_URL" alt="구글 로그인" width="150" height="40">-->
<!--</a>-->

<!--</body>-->
<!--</html>-->
